<?xml version="1.0" encoding="utf-8" ?>
<database Name="otrs">

<!-- Fix bug#8490 - no history record for title update -->
<Insert Table="ticket_history_type">
    <Data Key="name" Type="Quote">TitleUpdate</Data>
    <Data Key="valid_id">1</Data>
    <Data Key="create_by">1</Data>
    <Data Key="create_time">current_timestamp</Data>
    <Data Key="change_by">1</Data>
    <Data Key="change_time">current_timestamp</Data>
</Insert>

<TableAlter Name="dynamic_field_value">

    <!-- rename index -->
    <IndexDrop Name="index_search_date"/>
    <IndexCreate Name="dynamic_field_value_search_date">
        <IndexColumn Name="field_id"/>
        <IndexColumn Name="value_date"/>
    </IndexCreate>

    <!-- rename index -->
    <IndexDrop Name="index_search_int"/>
    <IndexCreate Name="dynamic_field_value_search_int">
        <IndexColumn Name="field_id"/>
        <IndexColumn Name="value_int"/>
    </IndexCreate>

    <!-- rename and change index -->
    <IndexDrop Name="index_field_values"/>
    <IndexCreate Name="dynamic_field_value_field_values">
        <IndexColumn Name="object_id"/>
    </IndexCreate>

</TableAlter>

<TableAlter Name="article">
    <IndexDrop Name="article_message_id"/>
    <ColumnAdd Name="a_message_id_md5" Required="false" Size="32" Type="VARCHAR"/>
    <IndexCreate Name="article_message_id_md5">
        <IndexColumn Name="a_message_id_md5"/>
    </IndexCreate>
</TableAlter>
<TableAlter Name="article_search">
    <IndexDrop Name="article_search_message_id"/>
    <ColumnDrop Name="a_message_id"/>
</TableAlter>

<!-- system data -->
<Table Name="system_data">
    <Column Name="data_key" Required="true" PrimaryKey="true" Size="160" Type="VARCHAR"/>
    <Column Name="data_value" Required="false" Type="LONGBLOB"/>
    <Column Name="create_time" Required="true" Type="DATE"/>
    <Column Name="create_by" Required="true" Type="INTEGER"/>
    <Column Name="change_time" Required="true" Type="DATE"/>
    <Column Name="change_by" Required="true" Type="INTEGER"/>
    <ForeignKey ForeignTable="users">
        <Reference Local="create_by" Foreign="id"/>
        <Reference Local="change_by" Foreign="id"/>
    </ForeignKey>    
</Table>

<!-- acl - all acls from the editor -->
<TableCreate Name="acl">
    <Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="INTEGER"/>
    <Column Name="name" Required="true" Type="VARCHAR" Size="200"/>
    <Column Name="comments" Required="false" Size="250" Type="VARCHAR"/>
    <Column Name="description" Required="false" Size="250" Type="VARCHAR"/>
    <Column Name="valid_id" Required="true" Type="SMALLINT"/>
    <Column Name="stop_after_match" Required="false" Type="SMALLINT"/>
    <!-- configs stored as YAML like in the web service configuration -->
    <Column Name="config_match" Required="false" Type="LONGBLOB"/>
    <Column Name="config_change" Required="false" Type="LONGBLOB"/>
    <Column Name="create_time" Required="true" Type="DATE"/>
    <Column Name="create_by" Required="true" Type="INTEGER"/>
    <Column Name="change_time" Required="true" Type="DATE"/>
    <Column Name="change_by" Required="true" Type="INTEGER"/>
    <Unique Name="acl_name">
        <UniqueColumn Name="name"/>
    </Unique>
    <ForeignKey ForeignTable="valid">
        <Reference Local="valid_id" Foreign="id"/>
    </ForeignKey>
    <ForeignKey ForeignTable="users">
        <Reference Local="create_by" Foreign="id"/>
        <Reference Local="change_by" Foreign="id"/>
    </ForeignKey>
</TableCreate>

<!-- acl_sync - sync states for acls -->
<TableCreate Name="acl_sync">
    <Column Name="acl_id" Required="true" Size="200" Type="VARCHAR"/>
    <Column Name="sync_state" Required="true" Size="30" Type="VARCHAR"/>
    <Column Name="create_time" Required="true" Type="DATE"/>
    <Column Name="change_time" Required="true" Type="DATE"/>
</TableCreate>

</database>
